<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gallery</title>
    <link rel="stylesheet" type="text/css" href="global_style.css">

    <style>
        /* Style the header */
        #header {
            position: fixed;
            top: 0;
            width: 100%;
            background-color: white;
            padding: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        #header a {
            text-decoration: none;
            color: #333;
            margin-right: 10px;
            font-family: "Avenir", sans-serif;
        }

        #navbar {
            display: flex;
        }

        #navbar a {
            margin-right: 10px;
            font-family: "Avenir", sans-serif;
        }

        /* Style the dropdown menu */
        .dropdown {
            position: relative;
            display: inline-block;
        }

        .dropdown-content {
            display: none;
            position: absolute;
            background-color: #f9f9f9;
            min-width: 160px;
            box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
            z-index: 1;
        }

        .dropdown:hover .dropdown-content {
            display: block;
        }

        .dropdown-content a {
            color: black;
            padding: 12px 16px;
            text-decoration: none;
            display: block;
            font-family: "Avenir", sans-serif;
        }

        .dropdown-content a:hover {
            background-color: #f1f1f1;
        }
    </style>
    <!-- user control box style -->
    <style>
        #user_controls {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            margin-bottom: 40px;
        }
        #user_controls button {
            margin: 5px;
            padding: 10px 20px;
            font-size: 16px;
            background-color: #333;
            color: white;
            border: none;
            cursor: pointer;
            font-family: "Avenir", sans-serif;
            border-radius: 5px;
        }
        #user_controls select {
            margin: 5px;
            padding: 10px;
            font-size: 16px;
            font-family: "Avenir", sans-serif;
        }
        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 1000; /* Sit on top */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
        }

        .modal-content {
            background-color: #fefefe;
            margin: 15% auto; /* 15% from the top and centered */
            padding: 20px;
            border: 1px solid #888;
            width: 80%; /* Could be more or less, depending on screen size */
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
    </style> 
    <!-- body style -->
    <style>
        #wrapper {
            margin-top: 150px;
            margin-bottom:50px;
            margin-left:10%;
            margin-right:10%;
            /* padding: 200px; */
        }
        h1 {
            text-align: center;
            font-size: 48px;
            margin-bottom: 20px;
        }
        p {
            text-align: center;
            font-size: 18px;
            margin-bottom: 40px;
        }

        #model_gallery {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-around;
        }
        #model_gallery .model {
            flex: 1 0 30%;
            margin: 1em;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #f9f9f9;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            border-radius: 5px;
            overflow: hidden;
        }
        .model a img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        #model_gallery .model::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.5);
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 2;
        }
        #model_gallery .model:hover::before {
            opacity: 1;
        }
        #model_gallery .model .model-name {
            display: none;
            position: absolute;
            transform: none;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: black;
            padding: 10px;
            text-align: center;
            z-index: 10;
            font-size: 30px;
        }
        #model_gallery .model:hover .model-name {
            display: block;
        }
    </style>
</head>
<body>
    <noscript>Please enable Javascript to load the models on the page.</noscript>
    <script>
        /*
            Remember to add a listener to wait for the content of the document to be fully loaded.

            To do here: 
            upon the user input of a "filter" button:
                read the filter inputs
                Go through all the json files in the "models" folder, using the data in model_data.json 
                    If the model satisfies the filters, add it to the queue
                sort the queue if a sort filter was applied: name, date, etc
                display the models from the queue into model_gallery. For each display:
                    load the thumbnail as a link. When hovered, the model name appears
                    when clicked, link to gallery/model.html with the model name as a parameter

            To do in gallery.html:
             - add filter UI and sort UI
                - tags, also year, has cp, has video, etc
             - make the models appear in neat columns
             - missing hp sheep

            Note: sometimes the json files don't update because the old versions are cached in the local browser. make sure the deployed version doesn't have this issue. for testing, use incognito
        */
        //helper
        async function fetchFile(filename) {
            return fetch(filename)
                .then(response => response.json())
                .catch(error => console.error('Error:', error));
        }
        
        function model_sort(queue,order="date"){
            //inputs a queue and sorts based on user input
            //TODO: read user sorting input. a radio check box for date vs alphabetical, and then read that input and sort accordingly
            if (order == "date"){
                return queue.sort((a, b) => new Date(b[1].date) - new Date(a[1].date))
            }
            if (order =="alphabetical"){
                return queue.sort((a, b) => a[1].name.localeCompare(b[1].name))
            }
        }

        function display(queue,displayCP = false){
            //TODO: check if display CP or display photo is checked, and display accordingly
            const modelCount = document.getElementById('model_count_text');
            modelCount.textContent = "Models found: "+queue.length;
            const modelGallery = document.getElementById('model_gallery');
            while (modelGallery.firstChild) {
                modelGallery.removeChild(modelGallery.firstChild);
            }

            for(const [filename,model] of queue){
                const modelDiv = document.createElement('div');
                modelDiv.classList.add('model');

                // for(const tag of model.tags){
                //     modelDiv.classList.add(tag);
                // }
                modelGallery.appendChild(modelDiv);

                const modelLink = document.createElement('a');
                modelLink.href = `gallery/${filename.slice(0, -5)}.html`;
                modelDiv.appendChild(modelLink);

                const modelThumbnail = document.createElement('img');
                modelThumbnail.src = !displayCP?"src/thumbnails/"+model.photo[0]:"src/cps/"+model.cp[0];
                modelThumbnail.alt = model.name;
                modelLink.appendChild(modelThumbnail);
                const modelName = document.createElement('p');
                modelName.classList.add('model-name');
                modelName.textContent = model.name;
                modelLink.appendChild(modelName);
            }
        }
        
        async function search(tags=[],displayCP=false,sort="date"){
            console.log("refreshing search. searching for:",tags)
            const modelGallery = document.getElementById('model_gallery');
            function filter(model,tags){
                // check if all tags are present
                //True: model gets added to queue
                for(const tag of tags){
                    if(!model.tags.includes(tag) && tag){
                        return false;
                    }
                }
                return model.name != ""
            }

            model_data = await fetchFile("model_data.json");
            queue = []
            for (const filename of model_data.filenames){
                model = await fetchFile("src/models/"+filename);
                if(filter(model,tags)){
                    queue.push([filename,model])
                }
            }
            display(model_sort(queue),displayCP);
        }
        (async function(){
            model_data = await fetchFile("model_data.json");
            dropdown = document.getElementById("tag_filter");
            for (const tag of model_data.tags){
                const option = document.createElement("option");
                option.value = tag[0];
                option.textContent = tag[0] + " ("+tag[1]+")";
                dropdown.appendChild(option);
            }
        })();

        function searchBar(){
            const searchBar = document.getElementById("searchBar");
            search([searchBar.value]);
            //TODO: add search for model name
        }
        
        function toggleAdvancedSearch() {
            var advancedSearch = document.getElementById('advancedSearch');
            if (advancedSearch.style.display === 'none') {
                advancedSearch.style.display = 'block';
            } else {
                advancedSearch.style.display = 'none';
            }
        }

        function applyAdvancedSearch() {
            var tag1 = document.getElementById('tag1').checked;
            var tag2 = document.getElementById('tag2').checked;
            // Get the values of other checkboxes as needed...
            // Perform the search with the selected tags...
            document.getElementById('advancedSearch').style.display = 'none';
        }
        
        
        var search_tags = [];

        function addTag(tag,displayCP=false) {
            if (!search_tags.includes(tag)) {
                search_tags.push(tag);
            }
            search(search_tags,displayCP);
        }

        function removeTag(tag,displayCP=false) {
            var index = search_tags.indexOf(tag);
            if (index !== -1) {
                search_tags.splice(index, 1);
            }
            search(search_tags,displayCP);
        }

        function setSearchTags(tags,displayCP=false) {
            search_tags = tags;
            search(search_tags,displayCP);
        }
    </script>

    <div id="header" style="position: fixed; top: 0; width: 100%; background-color: white; z-index: 100;">
        <a id="logo_home" href="index.html"><img src="img/logo.svg" alt=""></a>
        <div id="navbar">
            <!-- later, make these as drop down menus for subpages -->
            <!-- See how lang does it -->
            <a href="gallery.html"><button>Gallery</button></a>
            <a href="engineering.html"><button>Engineering</button></a>
            <a href="learn.html"><button>Learn</button></a>
            <a href="about.html"><button>About</button></a>
            <a href="business.html"><button>Business</button></a>
            
        </div>
        </div>
    </div>
    <div id="wrapper">
        <h1>Gallery</h1>
        <div id="user_controls">
            <button id="search_all" onclick="{setSearchTags([])}">All</button>
            <button id="search_portfolio" onclick="setSearchTags(['portfolio'])">Portfolio</button>

            <button onclick="toggleAdvancedSearch()">Advanced Search</button>

        </div>
        <div id="advancedSearch" class="modal">
            <div class="modal-content">
                <!-- TODO: design the advanced search window  
                    Search bar + button
                    Display by photo vs display by CP (toggle switch)
                    or vs and? or always do and
                    
                    Search by subject (columns of checkboxes)
                    Search by design style (columns of checkboxes)
                    Search by years (columns of radio check boxes)
                    Search by other tags (columns of checkboxes)
                -->
                <span class="close" onclick="toggleAdvancedSearch()">&times;</span>
                <input type="text" id="searchBar" placeholder="Search...">
                <button onclick="searchBar()">Search</button>
                <label>
                    <input type="checkbox" id="tag1" value="tag1">
                    Tag 1
                </label>
                <select id="tag_filter" onchange="search([this.value])">
                    <option value="">All</option>
                </select>
                <label>
                    <input type="checkbox" id="tag2" value="tag2">
                    Tag 2
                </label>
                <button onclick="applyAdvancedSearch()">Apply</button>
                <br>
                <br>
                <p>(this functionality is still under construction)</p>
            </div>
        </div>
        <div id="model_count">
            <p><i id="model_count_text"></i></p>
        </div>
        <div id="model_gallery">
            <!-- model divs will be added here by the script -->
        </div>    
    </div>
    <div id = "footer">
        <div id="socials">
            <div class = "social" >
                <a href="https://www.instagram.com/theplantpsychologist/"><img src="img/instagram.png" alt=""></a>
            </div>
            <div class="social">
                <a href="https://www.youtube.com/c/ThePlantPsychologist"><img src="img/youtube.png" alt=""></a>
            </div>
            <div class="social">
                <a href="https://github.com/theplantpsychologist"><img src="img/github.png" alt=""></a>
            </div>
            <div class="social">
                <a href="https://www.tiktok.com/@theplantpsychologist"><img src="img/tiktok.png" alt=""></a>
            </div>
            <div class="social">
                <a href="https://twitter.com/brandon_w0ng"><img src="img/X.png" alt=""></a>
            </div>
            <div class="social">
                <a href="https://discord.gg/AyQ3mNrkdr"><img src="img/discord.png" alt=""></a>
            </div>

            <div class="social">
                <a href="https://www.linkedin.com/in/brandonwong1/"><img src="img/linkedin.png" alt=""></a>
            </div>
            <div class="social">
                <a href="mailto:theplantpsychologist@gmail.com"><img src="img/email.png" alt=""></a>
            </div>
        </div>
        <p>©2024 Brandon Wong. All rights reserved.</p>
    </div>

    <script>
        //default loadup
        // let search_tags = [];
        search(search_tags);
    </script>
</body>
</html>